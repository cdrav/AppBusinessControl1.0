<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nueva Venta - Business Control</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <div class="page-wrapper">
    <div class="form-container fade-in" style="max-width: 900px;">
      <div class="form-header">
        <i class="bi bi-cart-plus form-icon"></i>
        <h1 class="form-title">Registrar Nueva Venta</h1>
        <p class="form-subtitle">Completa los detalles de la transacción</p>
      </div>
      
      <form id="addSaleForm">
        <!-- Barcode Scanner -->
        <div class="card border-0 shadow-sm p-4 mb-4">
            <h5 class="fw-bold mb-3"><i class="bi bi-upc-scan me-2"></i>Escanear Producto</h5>
            <input type="text" id="barcodeScannerInput" class="form-control form-control-lg" placeholder="Escanea el código de barras aquí..." autofocus>
            <div id="scanMessage" class="mt-2 small"></div>
        </div>

        <!-- Sale Details -->
        <div class="row g-4 mb-4">
          <div class="col-md-6">
            <label for="clientId" class="form-label">Cliente</label>
            <select id="clientId" class="form-select" required></select>
          </div>
          <div class="col-md-6">
            <label for="saleDate" class="form-label">Fecha de Venta</label>
            <input type="date" id="saleDate" class="form-control" required>
          </div>
        </div>

        <div class="mb-4">
            <label for="saleNotes" class="form-label">Notas / Observaciones (Opcional)</label>
            <textarea class="form-control" id="saleNotes" rows="2" placeholder="Ej. Entregar después de las 5pm"></textarea>
        </div>

        <!-- Products Section -->
        <h5 class="fw-bold mb-3">Productos</h5>
        <div id="productsContainer" class="mb-4">
          <!-- First product item -->
          <div class="product-item">
            <div class="product-info">
              <select class="form-control product-select" required style="width: 250px;">
                <option value="">Selecciona un producto</option>
              </select>
            </div>
            <div class="d-flex align-items-center gap-3">
              <input type="number" class="form-control quantity-input" placeholder="Cantidad" min="1" required style="width: 100px;">
              <span class="product-price">$0.00</span>
              <button type="button" class="btn btn-danger btn-sm remove-product">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-outline-primary btn-sm mb-4" onclick="addProductField()">
          <i class="bi bi-plus-lg"></i> Agregar otro producto
        </button>

        <!-- Summary -->
        <div class="sale-summary">
          <div class="summary-item">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          
          <!-- Sección de Cupón -->
          <div class="input-group input-group-sm my-2" style="max-width: 250px; margin-left: auto;">
            <input type="text" class="form-control" id="couponCode" placeholder="Código de cupón">
            <button class="btn btn-outline-secondary" type="button" onclick="applyCoupon()">Aplicar</button>
          </div>
          <div id="couponMessage" class="text-end small mb-2"></div>

          <div class="summary-item text-success" id="discountRow" style="display:none;">
            <span>Descuento:</span>
            <span id="discountValue">-$0.00</span>
          </div>

          <div class="summary-item">
            <span>Impuestos (16%):</span>
            <span id="tax">$0.00</span>
          </div>
          <div class="summary-item total">
            <span>Total a Pagar:</span>
            <span id="total">$0.00</span>
          </div>
          
          <!-- Cálculo de Cambio -->
          <div class="mt-3 pt-3 border-top">
              <div class="mb-2">
                  <label class="form-label small fw-bold text-muted">Monto Pagado</label>
                  <div class="input-group">
                      <span class="input-group-text bg-light">$</span>
                      <input type="number" class="form-control fw-bold" id="amountPaid" min="0" step="0.01" placeholder="0.00">
                  </div>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-bold text-dark">Cambio:</span>
                  <span class="fw-bold fs-4 text-primary" id="changeAmount">$0.00</span>
              </div>
          </div>
        </div>
        
        <div class="d-flex gap-3 mt-5">
          <button type="submit" class="btn btn-primary flex-fill btn-submit">
            <i class="bi bi-check-circle me-2"></i>
            Confirmar Venta
          </button>
          <a href="dashboard.html" class="btn-back">
            <i class="bi bi-x-circle"></i>
            Cancelar
          </a>
        </div>
      </form>
      <div id="message" class="mt-3"></div>
    </div>
  </div>

  <script src="js/addSale.js"></script>
  <footer class="main-footer"><p class="mb-0">&copy; 2026 Business Control.</p></footer>
</body>
</html>